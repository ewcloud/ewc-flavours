---
- name: Install IPA client and enroll into an IPA server's LDAP/DNS services via Morpheus
  hosts: all
  become: true
  become_user: root
  become_method: ansible.builtin.sudo

  vars:
    password_allowed_ip_ranges_override: ['10.0.0.0/24', '192.168.1.0/24']

  tasks:
    - name: EWC Ansible Role IPA Client Enroll
      ansible.builtin.include_role:
        name: ewc-ansible-role-ipa-client-enroll-1.0.0
      vars:
        password_allowed_ip_ranges: "{{ password_allowed_ip_ranges_override }}"
        ipa_client_hostname: "{{ inventory_hostname }}"
        ipa_domain: "{{ lookup('cypher', 'secret=secret/ipa_domain') }}"
        ipa_admin_username: "{{ lookup('cypher', 'secret=secret/ipa_admin_username') }}"
        ipa_admin_password: "{{ lookup('cypher', 'secret=secret/ipa_admin_password') }}"
        ipa_server_hostname: "{{ lookup('cypher', 'secret=secret/ipa_server_hostname') }}"
